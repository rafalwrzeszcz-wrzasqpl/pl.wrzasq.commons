<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2021-09-08 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20210908" />
    <meta http-equiv="Content-Language" content="en" />
    <title>WrzasqPl Commons Client &#x2013; Feign factory</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
      <script type="text/javascript" src="../js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>WrzasqPl Commons Client</h2>
</div>
</div>
        <div class="pull-right"><a href="https://wrzasq.pl" id="bannerRight"><h2><img src="https://static.wrzasq.pl/images/wrzasqpl.png" alt="Wrzasq.pl"/></h2>
</a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Main</li>
    <li><a href="https://github.com/rafalwrzeszcz-wrzasqpl/pl.wrzasq.commons/" class="externalLink" title="GitHub project"><span class="none"></span>GitHub project</a>  </li>
    <li><a href="https://wrzasq.pl/" class="externalLink" title="Wrzasq.pl"><span class="none"></span>Wrzasq.pl</a>  </li>
    <li><a href="https://www.facebook.com/wrzasqpl" class="externalLink" title="Wrzasq.pl @ Facebook"><span class="none"></span>Wrzasq.pl @ Facebook</a>  </li>
          <li class="nav-header">Parent Project</li>
    <li><a href="../../index.html" title="WrzasqPl Commons"><span class="none"></span>WrzasqPl Commons</a>  </li>
          <li class="nav-header">Guide</li>
    <li class="active"><a href="#"><span class="none"></span>Factory</a>
  </li>
    <li><a href="../guide/delegate-decoder.html" title="Content-Type delegation"><span class="none"></span>Content-Type delegation</a>  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="https://maven.apache.org/" title="Maven" class="builtBy"><img class="builtBy"  alt="Apache Maven" src="https://maven.apache.org/images/logos/maven-feather.png"    /></a>
<a href="https://wrzasq.pl" title="Wrzasq.pl" class="builtBy"><img class="builtBy"  alt="Wrzasq.pl" src="https://static.wrzasq.pl/images/wrzasqpl.png"    /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<!---
# This file is part of the pl.wrzasq.commons.
#
# @license http://mit-license.org/ The MIT license
# @copyright 2017, 2019, 2021 © by Rafał Wrzeszcz - Wrzasq.pl.
-->
<h1>Feign factory</h1>
<p>Entire <code>commons-client</code> package is oriented around <a class="externalLink" href="https://github.com/OpenFeign/feign"><b>Feign</b></a>. The main class to work with it is <code>pl.wrzasq.commons.client.FeignClientFactory</code>. It provides a way to automate your <code>Feign.builder()</code> customization. It&#x2019;s mainly useful when you develop multi micro-service system with a lot of clients sharing same serialization handling, authorization flow etc.</p><section>
<h2><a name="BaseFeignClientFactory"></a><code>BaseFeignClientFactory</code></h2>
<p>In most cases you can use <code>pl.wrzasq.commons.client.FeignClientFactory</code>, which creates a client using <code>Feign.Builder</code>. Thanks to that all you need to do is to specify your configurators. Configurators are callbacks that operate on <i>Feign</i> client builder to set it up. By creating a factory with given set of configurators you are sure that all clients created by the factory will be configured the same way. For example if you always need to set your <b>HTTP</b> client as <code>ApacheHttpClient</code>, if you want to apply your custom error decoder:</p>

<div class="source">
<div class="source"><pre class="prettyprint">val yourConfigurators = listOf
    // note that you can write plain lambda expressions, as we use plain `Consumer&lt;&gt;` interface
    {
        it.client(
            ApacheHttpClient(
                // this is AWS X-Ray enabled client builder
                HttpClientBuilder.create().build()
            )
        )
    }

val factory = FeignClientFactory(yourConfigurators)

val client1 = factory.createClient(YourClient1::class.java, &quot;http://service1.internal&quot;)
val client2 = factory.createClient(YourClient2::class.java, &quot;http://service2.internal&quot;)
</pre></div></div>

<p>In the example above all clients created with the factory will use <a class="externalLink" href="http://docs.aws.amazon.com/xray/latest/devguide/xray-sdk-java-httpclients.html"><b>AWS X-Ray</b>-instrumented Apache HTTP client</a>.</p></section><section>
<h2><a name="Client-specific_setup"></a>Client-specific setup</h2>
<p>Sometimes there is still need for some client-specific customization that won&#x2019;t be applied to other instances (date formatting? null-handling? case convention?). You can pass custom configurators (or just build an inline lambda expression) to customize the builder before creating the client you want:</p>

<div class="source">
<div class="source"><pre class="prettyprint">val factory = BaseFeignClientFactory(yourConfigurators)

// this will apply only default configurators (`yourConfigurators`)
val client1 = factory.createClient(YourClient1::class.java, &quot;http://service1.internal&quot;)
// this will apply both `yourConfigurators` and `customConfigurators`
val client2 = factory.createClient(YourClient2::class.java, &quot;http://service2.internal&quot;, customConfigurators)
// this will apply `yourConfigurators and apply lambda
val client3 = factory.createClient(
    YourClient3::class.java,
    &quot;http://service3.internal&quot;) {
    it
        .logger(Slf4jLogger(YourClient3::class.java))
        .decoder(JacksonDecoder(objectMapper))
}
</pre></div></div>

<p>Client-specific configurators are applied after default ones, so you can use them to override your generic setup.</p></section><section>
<h2><a name="Custom_Feign.Builder"></a>Custom <code>Feign.Builder</code></h2>
<p>What if you want to customize <code>Feign.Builder</code> itself? You specify builder supplier, when you create a factory:</p>

<div class="source">
<div class="source"><pre class="prettyprint">val factory = FeignClientFactory(
    yourConfigurators,
    HystrixFeign::builder // this is a regular Supplier&lt;&gt;, you can write own lambda
)
</pre></div></div></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2017&#x2013;2021
<a href="https://wrzasq.pl/">Rafał Wrzeszcz - Wrzasq.pl</a>.
All rights reserved.        <li id="publishDate" class="pull-right">Last Published: 2021-09-08</li>
          <li id="projectVersion" class="pull-right">Version: 2.0.6</li>
</p>
        </div>
        </div>
    </footer>
    </body>
</html>
